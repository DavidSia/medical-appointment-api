generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Patient {
  id           String        @id @default(uuid()) @db.Uuid
  name         String
  email        String        @unique
  phone        String
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  appointments Appointment[]

  @@map("patients")
}

model Doctor {
  id                 String        @id @default(uuid()) @db.Uuid
  name               String
  specialty          String
  appointmentPrice   Decimal       @db.Decimal(8, 2) @map("appointment_price")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  agendas            Agenda[]
  appointments       Appointment[]

  @@map("doctors")
}

model Agenda {
  id                   String   @id @default(uuid()) @db.Uuid
  doctorId             String   @db.Uuid @map("doctor_id")
  availableFromWeekDay Int      @map("available_from_week_day")
  availableToWeekDay   Int      @map("available_to_week_day")
  availableFromTime    String   @map("available_from_time")
  availableToTime      String   @map("available_to_time")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  doctor               Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@map("agendas")
}

enum AppointmentStatus {
  SCHEDULED
  IN_PROGRESS
  FINISHED
  CANCELED

  @@map("appointment_status")
}

model Appointment {
  id            String            @id @default(uuid()) @db.Uuid
  patientId     String            @db.Uuid @map("patient_id")
  doctorId      String            @db.Uuid @map("doctor_id")
  appointmentAt DateTime          @map("appointment_at")
  status        AppointmentStatus @default(SCHEDULED)
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  patient       Patient           @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctor        Doctor            @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@unique([doctorId, appointmentAt])
  @@unique([patientId, appointmentAt])
  @@map("appointments")
}
